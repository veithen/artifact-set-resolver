dist: trusty
language: java
jdk:
  - openjdk8
before_install: if [ -e $JAVA_HOME/lib/security/cacerts ]; then ln -sf /etc/ssl/certs/java/cacerts $JAVA_HOME/lib/security/cacerts; fi
install: true
script: mvn -B -s .travis-settings.xml -Prelease -Dgpg.skip=true verify
before_cache: "find $HOME/.m2 -name '*-SNAPSHOT' -a -type d -print0 | xargs -0 rm -rf"
jobs:
  include:
    - stage: test
    - if: repo = "veithen/maven" AND branch = master AND type = push
      stage: deploy
      script: mvn -B -s .travis-settings.xml -Prelease -Dgpg.skip=true -DskipTests=true deploy
      env:
        - secure: "pVUIRR6Ynkl9ujmXYU/O1KqPG9g1Rx6X3rFZ76OtltOwspptKi+3zbUAw9s5o3wlK8VktgTck2MIfTWKMypvjWcVIG0kQJTdD+4QLiBjbLQnRveaY2xe8so6UR65dJJEErTx+wxe1584Ii7HHW7bSVgA3Rtt5ru4zsK21BXH7rsnAEM/z2jW2PbKlv1lQGViXCsWkEBFeDWf1IslHTJijvVLf6EFZ7i1f9gXB1eB2RUz5DL/WgVHSqVKEqf02nMRIHuWVNFYe2P/HbDdlhvt2OEqE+PnmTujbaOtzvQqYpTRKUa+peyGxfITV9Q/HILA5wYTrgs5zR+g3hR8l1PCjWGARhpDdL9XPKbOKdjdg8aXXJWSC6DWClWS2A2zlEfP5hXlvhE7u7KCfIH3j3eonUmgLhL2bq/AazvHTDJkJUj/4d+mXnTyxLIWR0pipCpWBJtL3kok+JeWdfWwc3kcGsc0gRTel+uESR0nXnnSNty6zVUd5RKtsykHdgx8jIfI8+Up6ZTMB49CKc+dm39XwPMhoBgLwdYTMz87jlePKNCDy48wj8k0kfhWT8wP2ZoMHCzSL9S01apO+bRDOVGIEbg1y0xBtUC5QlfCKS50VQKxYvXLP1sqdSfYAhtqEGp6XF+adAuRSlkcfDGbjXhlIEbV/l+2lG+wHnFikwiM4uU="
cache:
  directories:
    - $HOME/.m2
